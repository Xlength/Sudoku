import { importStrategies } from './puzzle-import-strategies.js';

/**
 * 题目导入器 - 使用策略模式支持多种导入格式
 * 
 * OOAD设计原则：
 * 1. 单一职责：专门负责题目导入的协调
 * 2. 开闭原则：可以添加新的导入策略而不修改现有代码
 * 3. 依赖倒置：依赖ImportStrategy抽象，不依赖具体实现
 */
class PuzzleImporter {
	constructor(strategies = importStrategies) {
		this.strategies = strategies;
	}

	/**
	 * 将输入转换为sencode格式
	 * @param {string} input - 输入字符串
	 * @returns {Object|null} {source: string, sencode: string}
	 */
	toSencode(input) {
		const trimmed = (input || '').trim();
		
		// 按顺序尝试每个策略
		for (const strategy of this.strategies) {
			if (strategy.canHandle(trimmed)) {
				const result = strategy.parse(trimmed);
				if (result) return result;
			}
		}

		return null;
	}

	/**
	 * 验证输入是否有效
	 * @param {string} input - 输入字符串
	 * @returns {boolean}
	 */
	validate(input) {
		return !!this.toSencode(input);
	}
}

export const puzzleImporter = new PuzzleImporter();
