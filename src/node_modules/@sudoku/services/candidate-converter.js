import { SUDOKU_SIZE } from '@sudoku/constants';

/**
 * 候选数转换器 - 统一管理候选数在不同格式之间的转换
 * 
 * OOAD设计原则：
 * 1. 单一职责：专门负责候选数格式转换
 * 2. 开闭原则：可以扩展新的转换格式而不修改现有代码
 */
export class CandidateConverter {
	/**
	 * 将候选数字典转换为矩阵格式
	 * @param {Object} candidatesDict - 候选数字典 { "x,y": [1,2,3], ... }
	 * @returns {number[][][]} 候选数矩阵 [y][x] = [1,2,3,...]
	 */
	dictToMatrix(candidatesDict) {
		const candidates = [];
		for (let y = 0; y < SUDOKU_SIZE; y++) {
			candidates[y] = [];
			for (let x = 0; x < SUDOKU_SIZE; x++) {
				const key = `${x},${y}`;
				candidates[y][x] = candidatesDict[key] || [];
			}
		}
		return candidates;
	}

	/**
	 * 将候选数矩阵转换为字典格式
	 * @param {number[][][]} candidatesMatrix - 候选数矩阵 [y][x] = [1,2,3,...]
	 * @returns {Object} 候选数字典 { "x,y": [1,2,3], ... }
	 */
	matrixToDict(candidatesMatrix) {
		const candidates = {};
		for (let y = 0; y < SUDOKU_SIZE; y++) {
			for (let x = 0; x < SUDOKU_SIZE; x++) {
				if (candidatesMatrix[y][x] && candidatesMatrix[y][x].length > 0) {
					const key = `${x},${y}`;
					candidates[key] = candidatesMatrix[y][x];
				}
			}
		}
		return candidates;
	}
}

/**
 * 单例实例
 */
export const candidateConverter = new CandidateConverter();