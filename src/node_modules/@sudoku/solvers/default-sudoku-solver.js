import solve from '@mattflow/sudoku-solver';
import { GRID_LENGTH, GRID_COORDS } from '@sudoku/constants';
import { ISudokuSolver } from '../interfaces/sudoku-solver.js';

/**
 * 默认数独求解器实现
 * 
 * OOAD设计原则：
 * 1. 单一职责：只负责数独求解
 * 2. 依赖倒置：实现ISudokuSolver接口
 * 3. 开闭原则：可以替换为其他求解算法而不影响调用方
 */
export class DefaultSudokuSolver extends ISudokuSolver {
	solve(grid) {
		// 创建初始网格
		const initialGrid = [
			[0, 0, 0, 0, 0, 0, 0, 0, 0],
			[0, 0, 0, 0, 0, 0, 0, 0, 0],
			[0, 0, 0, 0, 0, 0, 0, 0, 0],
			[0, 0, 0, 0, 0, 0, 0, 0, 0],
			[0, 0, 0, 0, 0, 0, 0, 0, 0],
			[0, 0, 0, 0, 0, 0, 0, 0, 0],
			[0, 0, 0, 0, 0, 0, 0, 0, 0],
			[0, 0, 0, 0, 0, 0, 0, 0, 0],
			[0, 0, 0, 0, 0, 0, 0, 0, 0],
		];

		// 使用外部求解库
		const solution = solve(grid.flat().join(''), {
			outputArray: true,
			hintCheck: false
		});

		// 转换结果格式
		for (let cell = 0; cell < GRID_LENGTH; cell++) {
			const [row, col] = GRID_COORDS[cell];
			initialGrid[row][col] = solution[cell];
		}

		return initialGrid;
	}
}